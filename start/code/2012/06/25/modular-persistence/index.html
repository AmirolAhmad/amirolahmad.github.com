
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Modular Persistence</title>
  <meta name="description" content="with JPA2, EclipseLink and Google Guice">
  <meta name="author" content="Carlos Alexandro Becker">

  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/assets/themes/twitter/css/body.css" rel="stylesheet">	
  <link href="/assets/themes/twitter/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
  <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
  <link href="/assets/themes/twitter/bootstrap/css/docs.css" rel="stylesheet">
  <script src="/assets/themes/twitter/js/jquery.min.js"></script>
</head>

<body data-spy="scroll" data-offset="50" data-target=".navbar-fixed-top">

<div class="navbar navbar-fixed-top">
	<div class="navbar-inner">
		<div class="container">
			<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="brand" title="Home" href="/">caarlos0</a>
			<div class="nav-collapse collapse">
				<ul class="nav">
					
					
					


  
    
      
      	<li><a href="/about/index.html" title="About">About</a></li>
      
    
  
    
      
      	<li><a href="/archive.html" title="Archive">Archive</a></li>
      
    
  
    
      
    
  
    
      
      	<li><a href="/categories.html" title="Categories">Categories</a></li>
      
    
  
    
  
    
      
      	<li><a href="/pages.html" title="Pages">Pages</a></li>
      
    
  
    
      
    
  
    
      
      	<li><a href="/tags.html" title="Tags">Tags</a></li>
      
    
  




				</ul>
				<ul class="nav pull-right">
					<li><a href="/atom.xml" title="Atom Feed"><i class="icon-signal"></i> Feed</a></li>
				</ul>
			</div>
		</div>
	</div>
</div>


  
<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>Modular Persistence</h1>
    <p class="lead">with JPA2, EclipseLink and Google Guice</p>
    <h6>
      Published
      
      
      tagged with 


  
     
    	<a href="/tags.html#java-ref" rel="tooltip" title="see all posts about java"><span class="label label-info">java <span class="tag">7</span></span></a>
     
    	<a href="/tags.html#guice-ref" rel="tooltip" title="see all posts about guice"><span class="label label-info">guice <span class="tag">3</span></span></a>
     
    	<a href="/tags.html#jpa-ref" rel="tooltip" title="see all posts about jpa"><span class="label label-info">jpa <span class="tag">1</span></span></a>
    
  



       
      at 25 June 2012
    </h6>
  </div>
</header>
<p />
<div class="container">
  
  <p>One of the classes of my post-graduate was the Java Persistence API (<a href='http://jcp.org/en/jsr/detail?id=317'>JPA</a>).</p>

<p>The teacher used the &#8220;normal&#8221; way to create the projects: Eclipse, create libraries with jars that&#8217;s needed and create the EntityManagerFactory by hand.</p>

<p>It works, but IMHO, should never be used in production. In my examples and work, I used a standard architecture that I built. It&#8217;s using Maven, JPA2, EclipseLink, and MySQL Google Guice.</p>

<p>This structure decreased a lot time I would take to do several things, and as I found it very useful, I decided to put it on <a href='https://github.com/caarlos0/persistence-base'>github</a>.</p>

<p>To show hot it works, let&#8217;s do a little example.</p>

<h2 id='stepbystep_tutorial'>Step-by-step tutorial</h2>

<h3 id='get_the_base_code'>Get the base code</h3>

<p>First, clone the repo:</p>

<p><code>
git clone https://github.com/caarlos0/persistence-base sample
</code></p>

<h3 id='do_your_hacks'>Do your hacks</h3>

<p>Then, open the project in your preffered IDE, then, open the <code>pom.xml</code> file and change the project name to &#8220;sample&#8221;. Save.</p>

<p>Open <code>src/main/java/com/github/caarlos0/model</code> and create a class called <code>Foo</code> with the following code:</p>

<pre><code>@Entity
public class Foo extends Bean {
    
    private String bar;

    public Foo() {
    }

    public Foo(Long id, Long version, String bar) {
        super(id, version);
        this.bar = bar;
    }

    public String getBar() {
        return bar;
    }

    public void setBar(String bar) {
        this.bar = bar;
    }
}</code></pre>

<p>Now, we have to create the specific DAO for this entity. Go into <code>src/main/java/com/github/caarlos0/dao</code> and create a <code>FooDao.java</code>, with this code:</p>

<pre><code>public class FooDao extends AbstractDao&lt;Foo&gt; {
    @Inject
    public FooDao(Provider&lt;EntityManager&gt; emf) {
        super(emf, Foo.class);
    }
}</code></pre>

<p>We also need to setup our <code>PersistenceModule</code> to bind this DAO. Open <code>src/main/java/com/github/caarlos0/dao/inject/PersistenceModule.java</code> adding the bind to <code>FooDao</code> to look like this:</p>

<pre><code>public class PersistenceModule extends AbstractModule {

    @Override
    protected void configure() {
        install(new JpaPersistModule(&quot;base&quot;)); // base has to be the PU in persistence.xml
        
        bind(PersistenceInitializer.class);

        bind(FooDao.class);
    }
    
}</code></pre>

<p>If you want to change the <em>Persistence Unit</em> name, you will have to do this in the <code>install(new JpaPersistModule(&quot;base&quot;));</code> changing <em>base</em> to the name that you want, put the same name in <code>src/main/resources/META-INF/persistence.xml</code>.</p>

<p>We have to add classes, configure the database and etc in the <code>src/main/resources/META-INF/persistence.xml</code> file:</p>

<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence version=&quot;2.0&quot; xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;&gt;
  &lt;persistence-unit name=&quot;base&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;class&gt;com.github.caarlos0.model.Foo&lt;/class&gt;
    &lt;properties&gt;
      &lt;property name=&quot;javax.persistence.jdbc.url&quot; value=&quot;jdbc:mysql://localhost:3306/foodb&quot;/&gt;
      &lt;property name=&quot;javax.persistence.jdbc.password&quot; value=&quot;&quot;/&gt;
      &lt;property name=&quot;javax.persistence.jdbc.driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
      &lt;property name=&quot;javax.persistence.jdbc.user&quot; value=&quot;root&quot;/&gt;
      &lt;property name=&quot;eclipselink.ddl-generation&quot; value=&quot;create-tables&quot;/&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>

<h3 id='create_the_database'>Create the database</h3>

<p>Now, we have to create the database in our MySQL:</p>

<pre><code>[carlos@caarlos-archlinux sample]$ mysql -u root -p
mysql&gt; create database foodb;</code></pre>

<h3 id='test_it'>Test it</h3>

<p>Now, let&#8217;s write a test. Open <code>src/main/java/com/github/caarlos0/App.java</code> and do some code.</p>

<pre><code>public class App {
    public static void main(String[] args) {
        Injector i = PersistenceHelper.getInjector();

        FooDao dao = i.getInstance(FooDao.class);
        Foo foo = new Foo();
        foo.setBar(&quot;Beer!&quot;);
        dao.save(foo);
    }
}</code></pre>

<p>Run the tests with <code>mvn exec:java -Dexec.mainClass=&quot;com.github.caarlos0.App&quot; -Dexec.classpathScope=runtime</code> or direct in your IDE.</p>

<p>BOOM, it works :)</p>

<p>Good hack.</p>

  
    <hr class="soften" />
    <h2>Code on Github</h2>
    
    
    <iframe src="http://ghbtns.com/github-btn.html?user=caarlos0&repo=persistence-base&type=watch&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="110px" height="20px"></iframe>

<iframe src="http://ghbtns.com/github-btn.html?user=caarlos0&repo=persistence-base&type=fork&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="95px" height="20px"></iframe>

  

  <hr class="soften">
  <h2>Related Posts</h2>
    
      <a href="/code/2012/08/07/gunit---guice-and-junit-fall-in-love">GUnit - Guice and JUnit fall in love</a><br />
    
      <a href="/code/2012/08/06/guice-and-junit">Guice and JUnit</a><br />
    
      <a href="/code/2012/08/14/gwt-bootstrap-2040-released">GWT Bootstrap 2.0.4.0 released</a><br />
    
      <a href="/code/2012/08/08/rocking-out-with-google-guava">Rocking out with Google Guava</a><br />
    
      <a href="/code/2012/06/27/using-a-custom-bootstrap-theme-in-gwt-bootstrap">Using a custom TwBootstrap's theme in GWT-Bootstrap</a><br />
    
  </hr>


  <hr class="soften">

  <div class="well row-fluid">
    <ul class="thumbnails">
      <li class="span2 avatar-span2" >
	<a href="/about" class="thumbnail" rel="tooltip" title="see more info...">
	  <img src="http://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?rating=PG&amp;size=150" alt="Avatar">
	</a>
      </li>
      <li class="span10">
	<h2>About the Author</h2>
	<br />
	<p>
	  <a href="/about" title="see more info">Carlos</a> works in a <a href="http://www.ciphersec.com.br/"> security information company</a>, coding mostly Java (2+ years exp). 
	  He also worked in a lot of other projects using GWT, JSF, and others.
	  Like to pass some hours hacking around Maven and having ideas of cool and helpfull thing to code, but, have no much time to do this...
	  Creator, Architect and developer of <a title="see the demo!" href="http://gwtbootstrap.github.com">GWT-Bootstrap</a> Project. 
	  At the moment, studying Ruby and Ruby on Rails. 
	  He's also Linux and Android user.
	</p>
      </li>
    </ul>
  </div>

  <div class="pagination">
    <ul>
      
	<li class="prev"><a href="/junk/2012/06/24/hello-world" title="Hello World">&larr; Previous</a></li>
      
	<li><a href="/archive.html">Archive</a></li>
      
	<li class="next"><a href="/code/2012/06/26/getting-started-with-gwt-bootstrap" title="Getting started with GWT-Bootstrap">Next &rarr;</a></li>
      
    </ul>
  </div>

  <hr class="soften">

  <!-- AddThis Button BEGIN -->
  <div class="addthis_toolbox addthis_default_style ">
    <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    <a class="addthis_button_tweet"></a>
    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    <a class="addthis_counter addthis_pill_style"></a>
  </div>

  <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=caarlos0"></script>
  <!-- AddThis Button END -->

  <hr class="soften" />

  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'caarlos0blog'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</div> <!-- /container --> 


<style type="text/css">body{padding-top: 30px; }</style>

  
  <footer class="footer">
    <div class="container">
		  <p class="pull-right"><a href="#" onclick="$('html, body').animate({scrollTop: $('body').offset().top }, 2000);">Back to top</a></p>
		  <p>
		    All posts are written by <a href="/about">Carlos Alexandro Becker</a>
		    and are licenced under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>
		  </p>
		  <p>
		    Thanks to <a href="http://jekyllbootstrap.com" target="_blank" rel="tooltip" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a> and 
		    <a href="http://twitter.github.com/bootstrap/" target="_blank" rel="tooltip" title="Simple and flexible HTML, CSS, and Javascript for popular user interface components and interactions.">Twitter Bootstrap</a>
		  </p>
		  <h4>Blogroll</h4>
		  <ul class="footer-links">
		    <li><a href="http://www.carlos.inf.br/">Carlos Cabelo</a></li>
		    <li><a href="http://byfat.xxx/">By Fat</a></li>
		    <li><a href="http://blog.getbootstrap.com/">Twitter Bootstrap</a></li>
		  </ul>
    </div>
  </footer>

  

  <script src="/assets/themes/twitter/bootstrap/js/bootstrap.min.js"></script>
  <script>
    $('.content a[title]').each(function(){ $(this).attr('rel', 'tooltip'); });
    $('.navbar a[title]').each(function(){$(this).attr('rel', 'tooltip'); $(this).attr('data-placement', 'bottom');});
    $('[rel=tooltip]').tooltip();
  </script>
</body>
</html>

